import * as bp from '../.botpress'

export const welcomeWorkflow = async ({ client, conversation }: bp.MessageHandlerProps) => {
  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  await conversation.tags.user_telegram_id.set(conversation.userId)
  
  // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  const message = `–ü—Ä–∏–≤–µ—Ç! üëã –Ø –ø–æ–º–æ–≥–∞—é –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∏–¥–µ–∏ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ä–∞–±–æ—á–∏—Ö —Å–∏—Ç—É–∞—Ü–∏–π.

–†–µ—á—å –Ω–µ –æ –≥–æ—Ç–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏—è—Ö, –∞ –æ –≤—ã—è–≤–ª–µ–Ω–∏–∏ –º–æ–º–µ–Ω—Ç–æ–≤ –≤ —Ä–∞–±–æ—Ç–µ, –≥–¥–µ —á—Ç–æ-—Ç–æ –º–æ–∂–Ω–æ —É–ø—Ä–æ—Å—Ç–∏—Ç—å –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å. –ù–µ –Ω—É–∂–Ω–æ –∑–∞—Ä–∞–Ω–µ–µ –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç ‚Äî –ø—Ä–æ—Å—Ç–æ —Ä–∞—Å—Å–∫–∞–∂–µ—à—å –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏, –∞ —è –ø–æ–º–æ–≥—É —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫.

–ü–æ –∏—Ç–æ–≥–∞–º –æ–±—Å—É–∂–¥–µ–Ω–∏—è:
‚Ä¢ –ò–¥–µ—è –ø–æ–ø–∞–¥—ë—Ç –Ω–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –≤ Telegram –∫–∞–Ω–∞–ª
‚Ä¢ –ï—Å–ª–∏ –Ω–∞–±–µ—Ä—ë—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É ‚Äî –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
‚Ä¢ –¢—ã –ø–æ–ª—É—á–∏—à—å –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞

–¢—ã —Ä–∞–±–æ—Ç–∞–µ—à—å –≤ –º–µ–¥–∏—Ü–∏–Ω–µ –∏–ª–∏ –∑–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏?`

  await client.createMessage({
    conversationId: conversation.id,
    type: 'text',
    tags: {},
    payload: {
      text: message,
    },
  })
  
  // –î–æ–±–∞–≤–∏—Ç—å inline –∫–Ω–æ–ø–∫–∏
  await client.createMessage({
    conversationId: conversation.id,
    type: 'choice',
    tags: {},
    payload: {
      text: ' ',  // –ü—É—Å—Ç–æ–π —Ç–µ–∫—Å—Ç, –∫–Ω–æ–ø–∫–∏ –ø–æ–¥ –ø—Ä–µ–¥—ã–¥—É—â–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
      options: [
        { label: '‚úÖ –î–∞, —Ä–∞–±–æ—Ç–∞—é –≤ –º–µ–¥–∏—Ü–∏–Ω–µ', value: 'yes_medical' },
        { label: '‚ùå –ù–µ—Ç', value: 'no_medical' },
      ],
    },
  })
}
