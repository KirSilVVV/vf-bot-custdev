// AI Helper Ð´Ð»Ñ Customer Development Ð´Ð¸Ð°Ð»Ð¾Ð³Ð¾Ð²
// Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ OpenAI Ð´Ð»Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸ Ð² Ñ„Ð¾Ñ€Ð¼ÑƒÐ»Ð¸Ñ€Ð¾Ð²ÐºÐµ Ð¸Ð´ÐµÐ¹

// ðŸ“ Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐÐ«Ð™ ÐŸÐ ÐžÐœÐŸÐ¢ - Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€ÑƒÐ¹ Ð·Ð´ÐµÑÑŒ Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ AI
const SYSTEM_PROMPT = `Ð¢Ñ‹ - Ð¿Ð¾Ð¼Ð¾Ñ‰Ð½Ð¸Ðº Ð¿Ð¾ Customer Development Ð´Ð»Ñ Ð¼ÐµÐ´Ð¸Ñ†Ð¸Ð½ÑÐºÐ¾Ð³Ð¾ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð°.

Ð¢Ð²Ð¾Ñ Ð·Ð°Ð´Ð°Ñ‡Ð° - Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ Ñ‡ÐµÑ‚ÐºÐ¾ ÑÑ„Ð¾Ñ€Ð¼ÑƒÐ»Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¸Ð´ÐµÑŽ Ð½Ð¾Ð²Ð¾Ð¹ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ñ‡ÐµÑ€ÐµÐ· Ð´Ð¸Ð°Ð»Ð¾Ð³:

1. **ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ**: Ð¡Ð¿Ñ€Ð¾ÑÐ¸ ÐºÐ°ÐºÑƒÑŽ ÐŸÐ ÐžÐ‘Ð›Ð•ÐœÐ£ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ñ…Ð¾Ñ‡ÐµÑ‚ Ñ€ÐµÑˆÐ¸Ñ‚ÑŒ (Ð½Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ, Ð° Ð¸Ð¼ÐµÐ½Ð½Ð¾ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñƒ)
   ÐŸÑ€Ð¸Ð¼ÐµÑ€: "ÐšÐ°ÐºÑƒÑŽ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñƒ Ð² Ð¼ÐµÐ´Ð¸Ñ†Ð¸Ð½Ðµ Ñ‚Ñ‹ Ñ…Ð¾Ñ‡ÐµÑˆÑŒ Ñ€ÐµÑˆÐ¸Ñ‚ÑŒ?"

2. **Ð’Ñ‚Ð¾Ñ€Ð¾Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ**: ÐŸÐ¾ÑÐ»Ðµ Ð¾Ñ‚Ð²ÐµÑ‚Ð° ÑÐ¿Ñ€Ð¾ÑÐ¸ ÐšÐÐš Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð²Ð¸Ð´Ð¸Ñ‚ Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ (ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½ÑƒÑŽ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ)
   ÐŸÑ€Ð¸Ð¼ÐµÑ€: "ÐšÐ°Ðº Ñ‚Ñ‹ Ð²Ð¸Ð´Ð¸ÑˆÑŒ Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ? ÐžÐ¿Ð¸ÑˆÐ¸ Ð¶ÐµÐ»Ð°ÐµÐ¼ÑƒÑŽ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ"

3. **Ð¤Ð¸Ð½Ð°Ð»**: ÐŸÐ¾ÑÐ»Ðµ 2-3 ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ ÑÐºÐ°Ð¶Ð¸ Ñ‡Ñ‚Ð¾ Ð¸Ð´ÐµÑ Ð³Ð¾Ñ‚Ð¾Ð²Ð° Ð¸ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶Ð¸ ÐµÑ‘ Ð¾Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ñ‚ÑŒ

ÐŸÐ ÐÐ’Ð˜Ð›Ð:
- ÐŸÐ¸ÑˆÐ¸ ÐºÑ€Ð°Ñ‚ÐºÐ¾ (1-2 Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ)
- Ð—Ð°Ð´Ð°Ð²Ð°Ð¹ Ð¿Ð¾ 1 Ð²Ð¾Ð¿Ñ€Ð¾ÑÑƒ Ð·Ð° Ñ€Ð°Ð·
- Ð‘ÑƒÐ´ÑŒ Ð´Ñ€ÑƒÐ¶ÐµÐ»ÑŽÐ±Ð½Ñ‹Ð¼ Ð¸ Ð¼Ð¾Ñ‚Ð¸Ð²Ð¸Ñ€ÑƒÑŽÑ‰Ð¸Ð¼
- ÐÐµ Ð¿Ñ€ÐµÐ´Ð»Ð°Ð³Ð°Ð¹ ÑÐ²Ð¾Ð¸ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ, Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾Ð¼Ð¾Ð³Ð°Ð¹ ÑÑ„Ð¾Ñ€Ð¼ÑƒÐ»Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ
- ÐŸÐ¾ÑÐ»Ðµ 2-3 Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð³Ð¾Ð²Ð¾Ñ€Ð¸: "ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾! Ð¢Ð²Ð¾Ñ Ð¸Ð´ÐµÑ Ð³Ð¾Ñ‚Ð¾Ð²Ð° Ðº Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ð¸ ðŸŽ‰"

ÐšÐ¾Ð³Ð´Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð¿ÐµÑ€Ð²Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ - Ð½Ð°Ñ‡Ð¸Ð½Ð°Ð¹ Ð´Ð¸Ð°Ð»Ð¾Ð³.`;

export async function chatWithAI(openai, userMessages) {
    const messages = [
        { role: 'system', content: SYSTEM_PROMPT },
        ...userMessages
    ];
    
    const response = await openai.chat.completions.create({
        model: 'gpt-4o-mini',
        messages: messages,
        temperature: 0.7,
        max_tokens: 200,
    });
    
    return response.choices[0].message.content;
}

export function shouldOfferPublish(messageCount) {
    // ÐŸÐ¾ÑÐ»Ðµ 3+ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð¿Ñ€ÐµÐ´Ð»Ð°Ð³Ð°ÐµÐ¼ Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸ÑŽ
    return messageCount >= 3;
}
