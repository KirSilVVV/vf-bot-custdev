// AI Helper –¥–ª—è Customer Development –¥–∏–∞–ª–æ–≥–æ–≤
// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç OpenAI –¥–ª—è –ø–æ–º–æ—â–∏ –≤ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–µ –∏–¥–µ–π

// üìù –°–ò–°–¢–ï–ú–ù–´–ô –ü–†–û–ú–ü–¢ - —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π –∑–¥–µ—Å—å —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ AI
const SYSTEM_PROMPT = `–¢—ã - –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã–π –ø–æ–º–æ—â–Ω–∏–∫, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –∏–¥–µ—é –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ñ–∏—á—É, –∫–æ—Ç–æ—Ä—É—é –ò–ò –º–æ–∂–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞ –Ω–µ–¥–µ–ª—é.

–¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ –≤–æ—Ä–æ–Ω–∫—É –≤–æ–ø—Ä–æ—Å–æ–≤:

1. **–ü—Ä–æ–±–ª–µ–º–∞** (–í–æ–ø—Ä–æ—Å 1): "–ö–∞–∫—É—é –ø—Ä–æ–±–ª–µ–º—É –≤ –º–µ–¥–∏—Ü–∏–Ω–µ —Ç—ã —Ö–æ—á–µ—à—å —Ä–µ—à–∏—Ç—å?"
   –£—Ç–æ—á–Ω–∏: –∫—Ç–æ —Å—Ç—Ä–∞–¥–∞–µ—Ç –æ—Ç —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã, –∫–∞–∫ —á–∞—Å—Ç–æ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç

2. **–¢–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ** (–í–æ–ø—Ä–æ—Å 2): "–ö–∞–∫ —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É —Ä–µ—à–∞—é—Ç —Å–µ–π—á–∞—Å? –ß—Ç–æ –Ω–µ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç?"
   –í—ã—è—Å–Ω–∏: —á—Ç–æ –ª—é–¥–∏ –¥–µ–ª–∞—é—Ç —Å–µ–π—á–∞—Å, –ø–æ—á–µ–º—É —ç—Ç–æ –Ω–µ—É–¥–æ–±–Ω–æ

3. **–ñ–µ–ª–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ** (–í–æ–ø—Ä–æ—Å 3): "–ö–∞–∫ —Ç—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—à—å –∏–¥–µ–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ? –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –¥–µ–ª–∞—Ç—å?"
   –£—Ç–æ—á–Ω–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ñ–∏—á–∞

4. **–ö—Ä–∏—Ç–µ—Ä–∏–∏ —Ä–µ–∞–ª–∏–∑—É–µ–º–æ—Å—Ç–∏** (–í–æ–ø—Ä–æ—Å 4): "–ö–∞–∫–æ–π –º–∏–Ω–∏–º—É–º —Ñ—É–Ω–∫—Ü–∏–π –Ω—É–∂–µ–Ω –¥–ª—è —Ç–µ—Å—Ç–∞? –ß—Ç–æ –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å?"
   –ü–æ–º–æ–≥–∏ —É–ø—Ä–æ—Å—Ç–∏—Ç—å –¥–æ MVP, –∫–æ—Ç–æ—Ä—ã–π –ò–ò –º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å –∑–∞ –Ω–µ–¥–µ–ª—é

5. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π** (–í–æ–ø—Ä–æ—Å 5): "–û–ø–∏—à–∏ —à–∞–≥ –∑–∞ —à–∞–≥–æ–º: –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—É–¥–µ—Ç —ç—Ç–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?"
   –ü–æ–ª—É—á–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π user flow

–ü–†–ê–í–ò–õ–ê:
- –ó–∞–¥–∞–≤–∞–π –ø–æ 1 –≤–æ–ø—Ä–æ—Å—É –∑–∞ —Ä–∞–∑
- –ü–∏—à–∏ –∫—Ä–∞—Ç–∫–æ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –º–∞–∫—Å)
- –ë—É–¥—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º –∏ –ø–æ–º–æ–≥–∞–π —É–ø—Ä–æ—Å—Ç–∏—Ç—å –∏–¥–µ—é
- –ù–ï –ü–ï–†–ï–•–û–î–ò –ö –§–ò–ù–ê–õ–£ –ø–æ–∫–∞ –Ω–µ –∑–∞–¥–∞–ª –º–∏–Ω–∏–º—É–º 5 –≤–æ–ø—Ä–æ—Å–æ–≤
- –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ 5+ –æ—Ç–≤–µ—Ç–æ–≤ –≥–µ–Ω–µ—Ä–∏—Ä—É–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç

**–í–ê–ñ–ù–û! –§–ò–ù–ê–õ** (–¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ 5+ —Å–æ–æ–±—â–µ–Ω–∏–π):
–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π –¢–û–ß–ù–û —Ç–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç:

–û—Ç–ª–∏—á–Ω–æ! –£ –Ω–∞—Å –µ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–æ–≤–∞—è —Ñ–∏—á–∞ üéâ

üìã –ü–û–õ–ù–û–ï –û–ü–ò–°–ê–ù–ò–ï:
[–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ: –ø—Ä–æ–±–ª–µ–º–∞, —Ç–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ, –∂–µ–ª–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ, MVP –∫—Ä–∏—Ç–µ—Ä–∏–∏, user flow]

üì¢ –ö–†–ê–¢–ö–ò–ô –î–†–ê–§–¢ (–¥–æ 250 —Å–∏–º–≤–æ–ª–æ–≤):
[–û–¥–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ —Ñ–∏—á–µ –∏ –µ—ë —Ü–µ–Ω–Ω–æ—Å—Ç–∏]

–ö–†–ò–¢–ò–ß–ù–û: –ë–µ–∑ –º–∞—Ä–∫–µ—Ä–æ–≤ "üìã –ü–û–õ–ù–û–ï –û–ü–ò–°–ê–ù–ò–ï:" –∏ "üì¢ –ö–†–ê–¢–ö–ò–ô –î–†–ê–§–¢" —Ñ–∏—á–∞ –ù–ï –ë–£–î–ï–¢ –û–ü–£–ë–õ–ò–ö–û–í–ê–ù–ê!`;


export async function chatWithAI(openai, userMessages) {
    const messages = [
        { role: 'system', content: SYSTEM_PROMPT },
        ...userMessages
    ];
    
    const response = await openai.chat.completions.create({
        model: 'gpt-4o-mini',
        messages: messages,
        temperature: 0.7,
        max_tokens: 200,
    });
    
    return response.choices[0].message.content;
}

export function shouldOfferPublish(messageCount) {
    // –ü–æ—Å–ª–µ 5+ —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –ø—É–±–ª–∏–∫–∞—Ü–∏—é
    return messageCount >= 5;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –∏ –∫—Ä–∞—Ç–∫–æ–≥–æ –¥—Ä–∞—Ñ—Ç–∞ –∏–∑ –æ—Ç–≤–µ—Ç–∞ AI
export function parseAIFinalResponse(aiResponse) {
    const fullDescMatch = aiResponse.match(/üìã\s*–ü–û–õ–ù–û–ï –û–ü–ò–°–ê–ù–ò–ï:[\s\S]*?(?=üì¢|$)/i);
    const draftMatch = aiResponse.match(/üì¢\s*–ö–†–ê–¢–ö–ò–ô –î–†–ê–§–¢[^:]*:([\s\S]*?)$/i);
    
    let fullDescription = null;
    let shortDraft = null;
    
    if (fullDescMatch) {
        fullDescription = fullDescMatch[0]
            .replace(/üìã\s*–ü–û–õ–ù–û–ï –û–ü–ò–°–ê–ù–ò–ï:\s*/i, '')
            .replace(/üì¢\s*–ö–†–ê–¢–ö–ò–ô –î–†–ê–§–¢.*/is, '')
            .trim();
    }
    
    if (draftMatch) {
        shortDraft = draftMatch[1]
            .replace(/\[|\]/g, '')
            .trim()
            .substring(0, 300); // –õ–∏–º–∏—Ç 300 —Å–∏–º–≤–æ–ª–æ–≤
    }
    
    return { fullDescription, shortDraft };
}
